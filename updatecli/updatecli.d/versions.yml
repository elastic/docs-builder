---
name: Bump release versions in the config/versions.yml

scms:
  githubConfig:
    kind: github
    spec:
      user: '{{ requiredEnv "GITHUB_ACTOR" }}'
      username: '{{ requiredEnv "GITHUB_ACTOR" }}'
      owner: '{{ .scm.owner }}'
      repository: '{{ .scm.repository }}'
      token: '{{ requiredEnv "GITHUB_TOKEN" }}'
      commitusingapi: true
      branch: '{{ .scm.branch }}'
      force: false

actions:
  elastic-agent:
    kind: github/pullrequest
    scmid: githubConfig
    spec:
      automerge: false
      labels:
        - dependencies
      title: '[Automation] Bump EDOT versions'

sources:
  latest-edot-android-version:
    name: Get latest release version for the apm-agent-android
    kind: githubrelease
    transformers:
      - trimprefix: v
    spec:
      owner: elastic
      repository: apm-agent-android
      token: '{{ requiredEnv "GITHUB_TOKEN" }}'
      username: '{{ requiredEnv "GITHUB_ACTOR" }}'
      versionfilter:
        kind: latest

  latest-edot-collector-version:
    name: Get latest major release version for the elastic-agent
    kind: githubrelease
    transformers:
      - trimprefix: v
    spec:
      owner: elastic
      repository: elastic-agent
      token: '{{ requiredEnv "GITHUB_TOKEN" }}'
      username: '{{ requiredEnv "GITHUB_ACTOR" }}'
      versionFilter:
        kind: regex
        pattern: "v9.(\\d*).(\\d*)$"

  latest-edot-dotnet-version:
    name: Get latest release version for the elastic-otel-dotnet
    kind: githubrelease
    transformers:
      - trimprefix: v
    spec:
      owner: elastic
      repository: elastic-otel-dotnet
      token: '{{ requiredEnv "GITHUB_TOKEN" }}'
      username: '{{ requiredEnv "GITHUB_ACTOR" }}'
      versionfilter:
        kind: latest

  latest-edot-ios-version:
    name: Get latest release version for the apm-agent-ios
    kind: githubrelease
    transformers:
      - trimprefix: v
    spec:
      owner: elastic
      repository: apm-agent-ios
      token: '{{ requiredEnv "GITHUB_TOKEN" }}'
      username: '{{ requiredEnv "GITHUB_ACTOR" }}'
      versionfilter:
        kind: latest

  latest-edot-java-version:
    name: Get latest release version for the elastic-otel-java
    kind: githubrelease
    transformers:
      - trimprefix: v
    spec:
      owner: elastic
      repository: elastic-otel-java
      token: '{{ requiredEnv "GITHUB_TOKEN" }}'
      username: '{{ requiredEnv "GITHUB_ACTOR" }}'
      versionfilter:
        kind: latest

  latest-edot-node-version:
    name: Get latest release version for the elastic-otel-node
    kind: githubrelease
    transformers:
      - trimprefix: v
    spec:
      owner: elastic
      repository: elastic-otel-node
      token: '{{ requiredEnv "GITHUB_TOKEN" }}'
      username: '{{ requiredEnv "GITHUB_ACTOR" }}'
      versionFilter:
        kind: regex
        pattern: "^v(\\d*).(\\d*).(\\d*)$"

  latest-edot-php-version:
    name: Get latest release version for the elastic-otel-php
    kind: githubrelease
    transformers:
      - trimprefix: v
    spec:
      owner: elastic
      repository: elastic-otel-php
      token: '{{ requiredEnv "GITHUB_TOKEN" }}'
      username: '{{ requiredEnv "GITHUB_ACTOR" }}'
      versionfilter:
        kind: latest

  latest-edot-python-version:
    name: Get latest release version for the elastic-otel-python
    kind: githubrelease
    transformers:
      - trimprefix: v
    spec:
      owner: elastic
      repository: elastic-otel-python
      token: '{{ requiredEnv "GITHUB_TOKEN" }}'
      username: '{{ requiredEnv "GITHUB_ACTOR" }}'
      versionfilter:
        kind: latest

  latest-ece-version:
    name: Get latest release version for Elastic Cloud Enterprise
    kind: githubrelease
    transformers:
      - trimprefix: v
    spec:
      owner: elastic
      repository: cloud-enterprise
      token: '{{ requiredEnv "GITHUB_TOKEN" }}'
      username: '{{ requiredEnv "GITHUB_ACTOR" }}'
      versionfilter:
        kind: latest

  latest-eck-version:
    name: Get latest release version for Elastic Cloud on Kubernetes
    kind: githubrelease
    transformers:
      - trimprefix: v
    spec:
      owner: elastic
      repository: cloud-on-k8s
      token: '{{ requiredEnv "GITHUB_TOKEN" }}'
      username: '{{ requiredEnv "GITHUB_ACTOR" }}'
      versionfilter:
        kind: latest

  latest-ecctl-version:
    name: Get latest release version for ecctl
    kind: githubrelease
    transformers:
      - trimprefix: v
    spec:
      owner: elastic
      repository: ecctl
      token: '{{ requiredEnv "GITHUB_TOKEN" }}'
      username: '{{ requiredEnv "GITHUB_ACTOR" }}'
      versionfilter:
        kind: latest

  latest-curator-version:
    name: Get latest release version for Elasticsearch Curator
    kind: githubrelease
    transformers:
      - trimprefix: v
    spec:
      owner: elastic
      repository: curator
      token: '{{ requiredEnv "GITHUB_TOKEN" }}'
      username: '{{ requiredEnv "GITHUB_ACTOR" }}'
      versionfilter:
        kind: latest

  latest-apm-agent-dotnet-version:
    name: Get latest release version for APM .NET agent
    kind: githubrelease
    transformers:
      - trimprefix: v
    spec:
      owner: elastic
      repository: apm-agent-dotnet
      token: '{{ requiredEnv "GITHUB_TOKEN" }}'
      username: '{{ requiredEnv "GITHUB_ACTOR" }}'
      versionfilter:
        kind: latest

  latest-apm-agent-go-version:
    name: Get latest release version for APM Go agent
    kind: githubrelease
    transformers:
      - trimprefix: v
    spec:
      owner: elastic
      repository: apm-agent-go
      token: '{{ requiredEnv "GITHUB_TOKEN" }}'
      username: '{{ requiredEnv "GITHUB_ACTOR" }}'
      versionfilter:
        kind: latest

  latest-apm-agent-java-version:
    name: Get latest release version for APM Java agent
    kind: githubrelease
    transformers:
      - trimprefix: v
    spec:
      owner: elastic
      repository: apm-agent-java
      token: '{{ requiredEnv "GITHUB_TOKEN" }}'
      username: '{{ requiredEnv "GITHUB_ACTOR" }}'
      versionfilter:
        kind: latest

  latest-apm-agent-node-version:
    name: Get latest release version for APM Node.js agent
    kind: githubrelease
    transformers:
      - trimprefix: v
    spec:
      owner: elastic
      repository: apm-agent-nodejs
      token: '{{ requiredEnv "GITHUB_TOKEN" }}'
      username: '{{ requiredEnv "GITHUB_ACTOR" }}'
      versionfilter:
        kind: latest

  latest-apm-agent-php-version:
    name: Get latest release version for APM PHP agent
    kind: githubrelease
    transformers:
      - trimprefix: v
    spec:
      owner: elastic
      repository: apm-agent-php
      token: '{{ requiredEnv "GITHUB_TOKEN" }}'
      username: '{{ requiredEnv "GITHUB_ACTOR" }}'
      versionfilter:
        kind: latest

  latest-apm-agent-python-version:
    name: Get latest release version for APM Python agent
    kind: githubrelease
    transformers:
      - trimprefix: v
    spec:
      owner: elastic
      repository: apm-agent-python
      token: '{{ requiredEnv "GITHUB_TOKEN" }}'
      username: '{{ requiredEnv "GITHUB_ACTOR" }}'
      versionfilter:
        kind: latest

  latest-apm-agent-ruby-version:
    name: Get latest release version for APM Ruby agent
    kind: githubrelease
    transformers:
      - trimprefix: v
    spec:
      owner: elastic
      repository: apm-agent-ruby
      token: '{{ requiredEnv "GITHUB_TOKEN" }}'
      username: '{{ requiredEnv "GITHUB_ACTOR" }}'
      versionfilter:
        kind: latest

  latest-apm-agent-rum-version:
    name: Get latest release version for APM RUM agent
    kind: githubrelease
    transformers:
      - trimprefix: v
    spec:
      owner: elastic
      repository: apm-agent-rum-js
      token: '{{ requiredEnv "GITHUB_TOKEN" }}'
      username: '{{ requiredEnv "GITHUB_ACTOR" }}'
      versionfilter:
        kind: latest

targets:
  update-docs-docset-android:
    name: 'Update config/versions.yml edot-android {{ source "latest-edot-android-version" }}'
    scmid: githubConfig
    sourceid: latest-edot-android-version
    kind: file
    spec:
      file: config/versions.yml
      matchpattern: '(edot_android:\s+base:\s+[\d\.]+\s+current:)\s+(.+)'
      replacepattern: '$1 {{ source "latest-edot-android-version" }}'

  update-docs-docset-collector:
    name: 'Update config/versions.yml edot-collector {{ source "latest-edot-collector-version" }}'
    scmid: githubConfig
    sourceid: latest-edot-collector-version
    kind: file
    spec:
      file: config/versions.yml
      matchpattern: '(edot_collector:\s+base:\s+[\d\.]+\s+current:)\s+(.+)'
      replacepattern: '$1 {{ source "latest-edot-collector-version" }}'

  update-docs-docset-dotnet:
    name: 'Update config/versions.yml edot-dotnet {{ source "latest-edot-dotnet-version" }}'
    scmid: githubConfig
    sourceid: latest-edot-dotnet-version
    kind: file
    spec:
      file: config/versions.yml
      matchpattern: '(edot_dotnet:\s+base:\s+[\d\.]+\s+current:)\s+(.+)'
      replacepattern: '$1 {{ source "latest-edot-dotnet-version" }}'

  update-docs-docset-ios:
    name: 'Update config/versions.yml edot-ios {{ source "latest-edot-ios-version" }}'
    scmid: githubConfig
    sourceid: latest-edot-ios-version
    kind: file
    spec:
      file: config/versions.yml
      matchpattern: '(edot_ios:\s+base:\s+[\d\.]+\s+current:)\s+(.+)'
      replacepattern: '$1 {{ source "latest-edot-ios-version" }}'

  update-docs-docset-java:
    name: 'Update config/versions.yml edot-java {{ source "latest-edot-java-version" }}'
    scmid: githubConfig
    sourceid: latest-edot-java-version
    kind: file
    spec:
      file: config/versions.yml
      matchpattern: '(edot_java:\s+base:\s+[\d\.]+\s+current:)\s+(.+)'
      replacepattern: '$1 {{ source "latest-edot-java-version" }}'

  update-docs-docset-node:
    name: 'Update config/versions.yml edot-node {{ source "latest-edot-node-version" }}'
    scmid: githubConfig
    sourceid: latest-edot-node-version
    kind: file
    spec:
      file: config/versions.yml
      matchpattern: '(edot_node:\s+base:\s+[\d\.]+\s+current:)\s+(.+)'
      replacepattern: '$1 {{ source "latest-edot-node-version" }}'

  update-docs-docset-php:
    name: 'Update config/versions.yml edot-php {{ source "latest-edot-php-version" }}'
    scmid: githubConfig
    sourceid: latest-edot-php-version
    kind: file
    spec:
      file: config/versions.yml
      matchpattern: '(edot_php:\s+base:\s+[\d\.]+\s+current:)\s+(.+)'
      replacepattern: '$1 {{ source "latest-edot-php-version" }}'

  update-docs-docset-python:
    name: 'Update config/versions.yml edot-python {{ source "latest-edot-python-version" }}'
    scmid: githubConfig
    sourceid: latest-edot-python-version
    kind: file
    spec:
      file: config/versions.yml
      matchpattern: '(edot_python:\s+base:\s+[\d\.]+\s+current:)\s+(.+)'
      replacepattern: '$1 {{ source "latest-edot-python-version" }}'

  update-docs-docset-ece:
    name: 'Update config/versions.yml ece {{ source "latest-ece-version" }}'
    scmid: githubConfig
    sourceid: latest-ece-version
    kind: file
    spec:
      file: config/versions.yml
      matchpattern: '(ece:\s+base:\s+[\d\.]+\s+current:)\s+(.+)'
      replacepattern: '$1 {{ source "latest-ece-version" }}'

  update-docs-docset-eck:
    name: 'Update config/versions.yml eck {{ source "latest-eck-version" }}'
    scmid: githubConfig
    sourceid: latest-eck-version
    kind: file
    spec:
      file: config/versions.yml
      matchpattern: '(eck:\s+base:\s+[\d\.]+\s+current:)\s+(.+)'
      replacepattern: '$1 {{ source "latest-eck-version" }}'

  update-docs-docset-ecctl:
    name: 'Update config/versions.yml ecctl {{ source "latest-ecctl-version" }}'
    scmid: githubConfig
    sourceid: latest-ecctl-version
    kind: file
    spec:
      file: config/versions.yml
      matchpattern: '(ecctl:\s+base:\s+[\d\.]+\s+current:)\s+(.+)'
      replacepattern: '$1 {{ source "latest-ecctl-version" }}'

  update-docs-docset-curator:
    name: 'Update config/versions.yml curator {{ source "latest-curator-version" }}'
    scmid: githubConfig
    sourceid: latest-curator-version
    kind: file
    spec:
      file: config/versions.yml
      matchpattern: '(curator:\s+base:\s+[\d\.]+\s+current:)\s+(.+)'
      replacepattern: '$1 {{ source "latest-curator-version" }}'

  update-docs-docset-apm-agent-dotnet:
    name: 'Update config/versions.yml apm_agent_dotnet {{ source "latest-apm-agent-dotnet-version" }}'
    scmid: githubConfig
    sourceid: latest-apm-agent-dotnet-version
    kind: file
    spec:
      file: config/versions.yml
      matchpattern: '(apm_agent_dotnet:\s+base:\s+[\d\.]+\s+current:)\s+(.+)'
      replacepattern: '$1 {{ source "latest-apm-agent-dotnet-version" }}'

  update-docs-docset-apm-agent-go:
    name: 'Update config/versions.yml apm_agent_go {{ source "latest-apm-agent-go-version" }}'
    scmid: githubConfig
    sourceid: latest-apm-agent-go-version
    kind: file
    spec:
      file: config/versions.yml
      matchpattern: '(apm_agent_go:\s+base:\s+[\d\.]+\s+current:)\s+(.+)'
      replacepattern: '$1 {{ source "latest-apm-agent-go-version" }}'

  update-docs-docset-apm-agent-java:
    name: 'Update config/versions.yml apm_agent_java {{ source "latest-apm-agent-java-version" }}'
    scmid: githubConfig
    sourceid: latest-apm-agent-java-version
    kind: file
    spec:
      file: config/versions.yml
      matchpattern: '(apm_agent_java:\s+base:\s+[\d\.]+\s+current:)\s+(.+)'
      replacepattern: '$1 {{ source "latest-apm-agent-java-version" }}'

  update-docs-docset-apm-agent-node:
    name: 'Update config/versions.yml apm_agent_node {{ source "latest-apm-agent-node-version" }}'
    scmid: githubConfig
    sourceid: latest-apm-agent-node-version
    kind: file
    spec:
      file: config/versions.yml
      matchpattern: '(apm_agent_node:\s+base:\s+[\d\.]+\s+current:)\s+(.+)'
      replacepattern: '$1 {{ source "latest-apm-agent-node-version" }}'

  update-docs-docset-apm-agent-php:
    name: 'Update config/versions.yml apm_agent_php {{ source "latest-apm-agent-php-version" }}'
    scmid: githubConfig
    sourceid: latest-apm-agent-php-version
    kind: file
    spec:
      file: config/versions.yml
      matchpattern: '(apm_agent_php:\s+base:\s+[\d\.]+\s+current:)\s+(.+)'
      replacepattern: '$1 {{ source "latest-apm-agent-php-version" }}'

  update-docs-docset-apm-agent-python:
    name: 'Update config/versions.yml apm_agent_python {{ source "latest-apm-agent-python-version" }}'
    scmid: githubConfig
    sourceid: latest-apm-agent-python-version
    kind: file
    spec:
      file: config/versions.yml
      matchpattern: '(apm_agent_python:\s+base:\s+[\d\.]+\s+current:)\s+(.+)'
      replacepattern: '$1 {{ source "latest-apm-agent-python-version" }}'

  update-docs-docset-apm-agent-ruby:
    name: 'Update config/versions.yml apm_agent_ruby {{ source "latest-apm-agent-ruby-version" }}'
    scmid: githubConfig
    sourceid: latest-apm-agent-ruby-version
    kind: file
    spec:
      file: config/versions.yml
      matchpattern: '(apm_agent_ruby:\s+base:\s+[\d\.]+\s+current:)\s+(.+)'
      replacepattern: '$1 {{ source "latest-apm-agent-ruby-version" }}'

  update-docs-docset-apm-agent-rum:
    name: 'Update config/versions.yml apm_agent_rum {{ source "latest-apm-agent-rum-version" }}'
    scmid: githubConfig
    sourceid: latest-apm-agent-rum-version
    kind: file
    spec:
      file: config/versions.yml
      matchpattern: '(apm_agent_rum:\s+base:\s+[\d\.]+\s+current:)\s+(.+)'
      replacepattern: '$1 {{ source "latest-apm-agent-rum-version" }}'