@using Elastic.Markdown.Myst.Directives.CsvInclude
@inherits RazorSlice<CsvIncludeViewModel>

@using System.Globalization
@{
    var csvBlock = (CsvIncludeBlock)Model.DirectiveBlock;
    if (!csvBlock.Found)
    {
        return;
    }
    
    var csvRows = Model.GetCsvRows().ToList();
    if (!csvRows.Any())
    {
        return;
    }
    
    var columnCount = csvRows[0].Length;
    var columnWidths = Model.GetColumnWidthPercentages(columnCount);
}

<div class="table-wrapper">
    @if (!string.IsNullOrEmpty(csvBlock.Caption))
    {
        <div class="table-caption">@csvBlock.Caption</div>
    }
    
    <table@(columnWidths is not null ? " class=\"fixed-widths\"" : "")>
        @if (columnWidths is not null)
        {
            <colgroup>
                @foreach (var width in columnWidths)
                {
                    <col style="width:@(width.ToString("0.##", CultureInfo.InvariantCulture))%" />
                }
            </colgroup>
        }
        <thead>
            <tr>
                @for (var i = 0; i < csvRows[0].Length; i++)
                {
                    <th>@Model.RenderCell(csvRows[0][i])</th>
                }
            </tr>
        </thead>
        
        <tbody>
            @for (var rowIndex = 1; rowIndex < csvRows.Count; rowIndex++)
            {
                <tr>
                    @for (var i = 0; i < csvRows[rowIndex].Length; i++)
                    {
                        <td>@Model.RenderCell(csvRows[rowIndex][i])</td>
                    }
                </tr>
            }
        </tbody>
    </table>
</div>
