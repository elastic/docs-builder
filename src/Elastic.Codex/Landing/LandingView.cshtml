@inherits RazorSliceHttpResult<Elastic.Codex.Landing.LandingViewModel>
@using System.Linq
@using Elastic.Documentation.Svg
@using Elastic.Codex.Landing
@using Elastic.Codex.Navigation
@implements IUsesLayout<Elastic.Codex._Layout, GlobalLayoutViewModel>
@functions {
	public GlobalLayoutViewModel LayoutModel => Model.CreateGlobalLayoutModel();

	// Maps codex icon names to EUI icon names
	// EUI icons from https://eui.elastic.co/docs/components/display/icons/
	private static string GetIconSvg(string? icon)
	{
		var euiIconName = icon switch
		{
			// Elastic product logos
			"elasticsearch" => "logo_elasticsearch",
			"kibana" => "logo_kibana",
			"observability" => "logo_observability",
			"security" => "logo_security",
			"enterprise-search" => "logo_enterprise_search",
			"logstash" => "logo_logstash",
			"beats" => "logo_beats",
			"cloud" => "logo_cloud",
			// App icons
			"apm" => "app_apm",
			"fleet" => "app_fleet",
			"dev-tools" or "developer" => "app_devtools",
			"ci" or "ci-cd" => "app_pipeline",
			// Generic icons
			"integrations" => "package",
			"docs" or "documentation" => "documentation",
			"benchmark" => "vis_gauge",
			"migration" => "merge",
			"testing" or "qa" => "editor_checklist",
			"architecture" => "layers",
			"consulting" => "training",
			"artifactory" => "storage",
			"content-design" => "documentation",
			"control-plane" => "compute",
			_ => "logo_elasticsearch" // Default fallback
		};

		return EuiSvgIcons.GetIcon(euiIconName) ?? EuiSvgIcons.GetIcon("logo_elasticsearch") ?? string.Empty;
	}
}
@{
	var categories = Model.DocumentationSetsByCategory
		.Select(g => g.Key)
		.Where(c => !string.IsNullOrEmpty(c))
		.OrderBy(c => c)
		.ToList();
}
<section id="elastic-docs-v3" class="codex-landing" style="padding: 0 24px;">
	<!-- Filter Controls -->
	<div style="max-width: 800px; margin: 24px auto 32px auto; display: flex; gap: 16px; align-items: center;">
		<!-- Search Input -->
		<div style="flex: 1; position: relative;">
			<span style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #69707D; pointer-events: none;">
				<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
					<path fill-rule="evenodd" clip-rule="evenodd" d="M11.271 11.978l3.872 3.873a.502.502 0 00.708-.708l-3.565-3.564c2.38-2.747 2.267-6.923-.342-9.532-2.73-2.73-7.156-2.73-9.886 0-2.728 2.729-2.728 7.156 0 9.886 2.608 2.608 6.784 2.722 9.532.342l-.32.32zm-.32-.636a6.013 6.013 0 00-8.485-8.486 6.013 6.013 0 008.485 8.486z" fill="currentColor"/>
				</svg>
			</span>
			<input
				type="text"
				id="codex-filter-input"
				placeholder="Filter documentation sets"
				style="width: 100%; height: 40px; padding: 0 12px 0 40px; font-size: 14px; border: 1px solid #D3DAE6; border-radius: 6px; background: #fff; outline: none; transition: border-color 0.15s ease-in-out;"
			/>
		</div>
		<!-- Category Filter -->
		@if (categories.Count > 0)
		{
			<div style="min-width: 180px;">
				<select
					id="codex-category-filter"
					style="width: 100%; height: 40px; padding: 0 32px 0 12px; font-size: 14px; border: 1px solid #D3DAE6; border-radius: 6px; background: #fff url('data:image/svg+xml;charset=utf-8,%3Csvg xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22 width%3D%2216%22 height%3D%2216%22 viewBox%3D%220 0 16 16%22%3E%3Cpath d%3D%22M13.069 5.157L8.384 9.768a.546.546 0 01-.768 0L2.93 5.158a.552.552 0 00-.771 0 .53.53 0 000 .759l4.684 4.61a1.65 1.65 0 002.312 0l4.684-4.61a.53.53 0 000-.76.552.552 0 00-.771 0z%22 fill%3D%22%2369707D%22%2F%3E%3C%2Fsvg%3E') no-repeat right 12px center; appearance: none; cursor: pointer; outline: none; transition: border-color 0.15s ease-in-out;"
				>
					<option value="">All categories</option>
					@foreach (var category in categories)
					{
						<option value="@category">@category</option>
					}
				</select>
			</div>
		}
	</div>

	<!-- Documentation Sets Grid -->
	<div id="codex-grid" style="max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
		@{
			var docSets = Model.DocumentationSetsByCategory
				.SelectMany(g => g)
				.OrderBy(ds => ds.Title)
				.ToList();
		}
		@foreach (var docSet in docSets)
		{
			var icon = GetIconSvg(docSet.Icon);
			var categoryClass = docSet.Category switch
			{
				"observability" => "category-observability",
				"tooling" => "category-tooling",
				"security" => "category-security",
				"search" => "category-search",
				_ => "category-default"
			};
			<a href="@(docSet.Url ?? "#")"
			   hx-select-oob="#main-container"
			   preload="mousedown"
			   class="euiCard euiCard--paddingMedium euiCard--centerAligned euiCard--isClickable codex-card"
			   data-category="@(docSet.Category ?? "")"
			   data-title="@(docSet.Title?.ToLowerInvariant() ?? string.Empty)"
			   style="text-decoration: none; display: flex; flex-direction: column; align-items: center; padding: 24px 16px; border-radius: 6px; border: 1px solid #D3DAE6; background: white; transition: all 0.15s ease-in-out;">
				<div class="euiCard__top codex-card-icon">
					@(new HtmlString(icon))
				</div>
				<div class="euiCard__content" style="text-align: center;">
					<span class="euiCard__title euiTitle euiTitle--small" style="font-size: 16px; font-weight: 600; color: #1a1c21; display: block; margin-bottom: 8px;">
						@(docSet.Title ?? docSet.Name)
					</span>
					@if (!string.IsNullOrEmpty(docSet.Category))
					{
						<span class="codex-category-pill @categoryClass">@docSet.Category</span>
					}
					<div class="euiCard__description euiText euiText--small" style="font-size: 14px; color: #69707D; margin-top: 8px;">
						@docSet.PageCount pages
					</div>
				</div>
			</a>
		}
	</div>

	<div id="codex-no-results" class="hidden" style="text-align: center; padding: 48px 0; color: #69707D;">
		<p>No documentation sets match your filter.</p>
	</div>
</section>

<style>
	.codex-card:hover {
		border-color: #0077CC !important;
		box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1) !important;
		transform: translateY(-2px);
	}

	#codex-filter-input:focus,
	#codex-category-filter:focus {
		border-color: #0077CC;
		box-shadow: 0 0 0 1px #0077CC;
	}

	/* SVG icon centering */
	.codex-card-icon {
		display: flex;
		justify-content: center;
		align-items: center;
		width: 100%;
		height: 32px;
		margin-bottom: 12px;
	}

	.codex-card-icon svg {
		width: 32px;
		height: 32px;
	}

	/* Category pills */
	.codex-category-pill {
		display: inline-block;
		padding: 2px 10px;
		border-radius: 12px;
		font-size: 12px;
		font-weight: 500;
		text-transform: capitalize;
	}

	.category-observability {
		background-color: #E6F9F7;
		color: #006D65;
	}

	.category-tooling {
		background-color: #EEE6F9;
		color: #5A2D82;
	}

	.category-security {
		background-color: #FCE7E8;
		color: #BD271E;
	}

	.category-search {
		background-color: #E6F0F8;
		color: #006BB4;
	}

	.category-default {
		background-color: #F5F7FA;
		color: #69707D;
	}

	@@media (max-width: 992px) {
		#codex-grid {
			grid-template-columns: repeat(2, 1fr) !important;
		}
	}

	@@media (max-width: 600px) {
		#codex-grid {
			grid-template-columns: 1fr !important;
		}
	}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
	const filterInput = document.getElementById('codex-filter-input');
	const categoryFilter = document.getElementById('codex-category-filter');
	const grid = document.getElementById('codex-grid');
	const cards = grid.querySelectorAll('.codex-card');
	const noResults = document.getElementById('codex-no-results');

	function filterCards() {
		const searchTerm = filterInput.value.toLowerCase().trim();
		const selectedCategory = categoryFilter ? categoryFilter.value : '';
		let visibleCount = 0;

		cards.forEach(card => {
			const title = card.dataset.title;
			const category = card.dataset.category;
			const matchesSearch = !searchTerm || title.includes(searchTerm);
			const matchesCategory = !selectedCategory || category === selectedCategory;

			if (matchesSearch && matchesCategory) {
				card.style.display = '';
				visibleCount++;
			} else {
				card.style.display = 'none';
			}
		});

		noResults.classList.toggle('hidden', visibleCount > 0);
	}

	filterInput.addEventListener('input', filterCards);
	if (categoryFilter) {
		categoryFilter.addEventListener('change', filterCards);
	}
});
</script>
