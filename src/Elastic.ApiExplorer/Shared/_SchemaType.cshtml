@using Elastic.ApiExplorer.Schema
@inherits RazorSlice<Elastic.ApiExplorer.Schema.SchemaTypeContext>
@{
	var info = Model.TypeInfo;
	var sb = new System.Text.StringBuilder();

	// Build the display text with [] for arrays, {} for objects, enum/union markers
	if (info.IsArray)
	{
		sb.Append("<span class=\"array-icon\">[] </span>");
		if (info.IsValueType && info.ValueTypeBase != null)
		{
			sb.Append($"<span class=\"value-type-keyword\">{info.ValueTypeBase}</span> ");
		}
		else if (info.IsEnum)
		{
			sb.Append("<span class=\"enum-icon\">enum </span>");
		}
		else if (info.IsUnion)
		{
			sb.Append("<span class=\"union-icon\">union </span>");
		}
		else if (info.IsObject && !string.IsNullOrEmpty(info.SchemaRef) && (Model.HasActualProperties || info.HasLink))
		{
			sb.Append("<span class=\"object-icon\">{} </span>");
		}
	}
	else if (info.IsDictionary)
	{
		// Dictionary uses "map string to TypeName" format
		// Extract the value type name from the TypeName (format: "string to TypeName")
		var valueTypeName = info.TypeName.StartsWith("string to ") ? info.TypeName["string to ".Length..] : info.TypeName;

		// Format: "map string to {} ScriptField" with "string" and "ScriptField" as types (blue)
		sb.Append("<span class=\"map-keyword\">map </span>");
		sb.Append("<span>string</span>");
		sb.Append("<span class=\"map-keyword\"> to </span>");
		if (info.HasLink || Model.HasActualProperties)
		{
			sb.Append("<span class=\"object-icon\">{} </span>");
		}
		sb.Append($"<span>{System.Web.HttpUtility.HtmlEncode(valueTypeName)}</span>");
		// Early return for dictionaries - they have their own format
		<code class="schema-type">@Html.Raw(sb.ToString())</code>
		return;
	}
	else if (info.IsEnum)
	{
		// Enum marker
		sb.Append("<span class=\"enum-icon\">enum </span>");
	}
	else if (info.IsUnion)
	{
		// Union marker
		sb.Append("<span class=\"union-icon\">union </span>");
	}
	else if (info.IsValueType && info.ValueTypeBase != null)
	{
		// Show underlying type for named value types: "string Field" instead of just "Field"
		sb.Append($"<span class=\"value-type-keyword\">{info.ValueTypeBase}</span> ");
	}
	else if (info.IsObject && !string.IsNullOrEmpty(info.SchemaRef) && !info.HasLink && Model.HasActualProperties)
	{
		// Regular objects get {} only if they have properties
		sb.Append("<span class=\"object-icon\">{} </span>");
	}

	var displayName = System.Web.HttpUtility.HtmlEncode(info.TypeName);
	var titleAttr = !string.IsNullOrEmpty(info.SchemaRef) ? $" title=\"{info.SchemaRef}\"" : "";

	// Add {} prefix for linked types (they have dedicated pages)
	if (info.HasLink && !info.IsDictionary)
	{
		sb.Append("<span class=\"object-icon\">{} </span>");
	}

	sb.Append($"<span{titleAttr}>{displayName}</span>");
}
<code class="schema-type">@Html.Raw(sb.ToString())</code>
